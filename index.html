<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•™å­¦èµ„æºåº“</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: #f4f7f9; margin: 0; padding: 0; color: #333; -webkit-user-select: none; user-select: none; overflow-x: hidden; }
        
        /* é¡¶éƒ¨å¯¼èˆª */
        .header { background: #fff; padding: 15px 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 100; display: flex; align-items: center; justify-content: space-between; }
        .back-btn { display: none; padding: 8px 16px; background: #f0f0f0; border: none; border-radius: 20px; cursor: pointer; font-size: 14px; color: #333; font-weight: bold; }
        .back-btn:hover { background: #e0e0e0; }
        .site-title { font-size: 1.2rem; font-weight: 800; color: #2c3e50; margin: 0; }
        
        .container { max-width: 1200px; margin: 20px auto; padding: 0 20px; }

        /* ğŸ“ æ–‡ä»¶å¤¹è§†å›¾ */
        .folder-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; padding-top: 20px; }
        .folder-card { background: #fff; border-radius: 16px; padding: 30px; text-align: center; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 6px rgba(0,0,0,0.02); border: 2px solid transparent; }
        .folder-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.08); border-color: #007aff; }
        .folder-icon { font-size: 4rem; margin-bottom: 15px; display: block; }
        .folder-name { font-size: 1.2rem; font-weight: bold; color: #333; }
        .folder-count { font-size: 0.9rem; color: #999; margin-top: 5px; }

        /* ğŸ“„ æ–‡ä»¶åˆ—è¡¨è§†å›¾ */
        .file-grid { display: none; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        
        .card { background: #fff; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.05); transition: transform 0.2s; }
        .card:hover { transform: translateY(-3px); }
        
        /* æ ¸å¿ƒåª’ä½“å®¹å™¨ */
        .media-wrapper { width: 100%; aspect-ratio: 16/9; background: #000; position: relative; overflow: hidden; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        
        /* â–¶ï¸ è§†é¢‘å‡å°é¢ (ç‚¹å‡»å‰) */
        .video-placeholder { width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #222; color: #fff; }
        .play-icon { font-size: 3rem; opacity: 0.9; transition: transform 0.2s; }
        .video-placeholder:hover .play-icon { transform: scale(1.1); color: #007aff; }
        
        /* çœŸæ­£çš„è§†é¢‘æ ‡ç­¾ (ç‚¹å‡»åç”Ÿæˆ) */
        video { width: 100%; height: 100%; object-fit: contain; background: #000; outline: none; }

        /* å›¾ç‰‡ & PPT å°é¢ */
        .safe-img { width: 100%; height: 100%; object-fit: cover; pointer-events: none; }
        .ppt-cover { text-align: center; width: 100%; background: #f8f9fa; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .ppt-icon { font-size: 3rem; color: #ff6b6b; margin-bottom: 10px; }
        .ppt-hint { color: #007aff; font-size: 0.9rem; font-weight: bold; }

        .info { padding: 12px; border-top: 1px solid #eee; background: #fff; }
        .info h3 { margin: 0; font-size: 0.9rem; color: #444; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }

        /* ğŸ” å…¨å±é¢„è§ˆå¼¹çª— */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 1000; flex-direction: column; }
        .modal-header { height: 50px; display: flex; align-items: center; justify-content: space-between; padding: 0 20px; background: #1a1a1a; color: #fff; }
        .close-modal { background: none; border: none; color: #fff; font-size: 28px; cursor: pointer; line-height: 1; }
        .modal-body { flex: 1; width: 100%; height: 100%; position: relative; }
        iframe.full-viewer { width: 100%; height: 100%; border: none; background: #fff; }

        @media (max-width: 600px) {
            .folder-grid, .file-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body oncontextmenu="return false">

<div class="header">
    <div style="display:flex; align-items:center; gap:10px;">
        <button class="back-btn" id="backBtn" onclick="goHome()">â† è¿”å›ç›®å½•</button>
        <h1 class="site-title" id="pageTitle">å‡Œæ³°æ•™è‚²èµ„æºåº“é¦–é¡µ</h1>
    </div>
</div>

<div class="container">
    <div id="folderView" class="folder-grid"></div>
    <div id="fileView" class="file-grid"></div>
</div>

<div id="previewModal" class="modal">
    <div class="modal-header">
        <span id="modalTitle" style="font-size:0.9rem; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; max-width: 80%;">é¢„è§ˆ</span>
        <button class="close-modal" onclick="closeModal()">Ã—</button>
    </div>
    <div class="modal-body" id="modalContent"></div>
</div>

<script>
    // R2 æ ¹é“¾æ¥
    const r2Base = "https://pub-5c5bb9aa72d54e53abacca6b652c98e4.r2.dev/";
    // å¾®è½¯ Office åœ¨çº¿é¢„è§ˆ (åªè¯»æ¨¡å¼)
    const msViewer = "https://view.officeapps.live.com/op/embed.aspx?src=";

    // ================= é…ç½®åŒº =================
    const projects = [
        {
            id: "video",
            name: "æ•™å­¦è§†é¢‘ (72è®²)",
            icon: "ğŸ¬",
            color: "#e3f2fd",
            folderName: "ã€Šæ±½è½¦æ„é€ ã€‹/è§†é¢‘",
            items: [
        "1-æ±½è½¦åˆ†ç±»ä¸ç»“æ„è®¤çŸ¥.mp4", "2-æ±½è½¦è¯†åˆ«ä»£ç å’ŒæŠ€æœ¯å‚æ•°è®¤çŸ¥.mp4", "3.å‘åŠ¨æœºçš„æ€»ä½“ç»“æ„å’Œå·¥ä½œåŸç†è®¤çŸ¥.mp4",
        "4.æœºä½“ç»„åŠæ´»å¡è¿æ†ç»„è®¤çŸ¥.mp4", "5.æœºä½“ç»„ä¸æ´»å¡è¿æ†ç»„æ‹†å¸æ£€ä¿®.mp4", "6.æ›²è½´é£è½®ç»„è®¤çŸ¥.mp4",
        "7.æ›²è½´é£è½®ç»„æ‹†è£…æ£€ä¿®.mp4", "8.é…æ°”æœºæ„çš„ä¸»è¦éƒ¨ä»¶è®¤çŸ¥.mp4", "9.é…æ°”æœºæ„æ‹†è£…æ£€ä¿®.mp4",
        "10.ç‡ƒæ²¹ä¾›ç»™ç³»ç»Ÿè®¤çŸ¥.mp4", "11.ç‡ƒæ²¹ä¾›ç»™ç³»ç»Ÿæ‹†è£…æ£€ä¿®.mp4", "12.æ¶¦æ»‘ç³»ä¸»è¦éƒ¨ä»¶è®¤çŸ¥.mp4",
        "13.æ¶¦æ»‘ç³»ç»Ÿæ‹†è£…æ£€ä¿®.mp4", "14.å†·å´ç³»ç»Ÿä¸»è¦éƒ¨ä»¶è®¤çŸ¥.mp4", "15.å†·å´ç³»ç»Ÿæ‹†è£…æ£€ä¿®.mp4",
        "16.ç‚¹ç«ç³»çš„ä¸»è¦éƒ¨ä»¶è®¤çŸ¥.mp4", "17.ç‚¹ç«ç³»ç»Ÿæ‹†è£…æ£€ä¿®.mp4", "18.èµ·åŠ¨ç³»çš„ä¸»è¦éƒ¨ä»¶è®¤çŸ¥.mp4",
        "19.å¯åŠ¨ç³»ç»Ÿæ‹†è£…æ£€ä¿®.mp4", "20.ä¼ åŠ¨ç³»ç»ŸåŠå¸ƒç½®å½¢å¼è®¤çŸ¥.mp4", "21.ä¼ åŠ¨ç³»ç»ŸåŠ¨åŠ›ä¼ é€’è¿‡ç¨‹è®¤çŸ¥.mp4",
        "22.ç¦»åˆå™¨è®¤çŸ¥.mp4", "23.ç¦»åˆå™¨æ‹†è£…æ£€ä¿®.mp4", "24.ç¦»åˆå™¨å¸¸è§æ•…éšœåˆ†æä¸æ’é™¤.mp4",
        "25.å˜é€Ÿå™¨è®¤çŸ¥ä¸å˜æŒ¡è¿‡ç¨‹è®¤çŸ¥.mp4", "26.è¡¨é€Ÿå™¨æ²¹æ¶²æ’æ”¾ä¸åŠ æ³¨.mp4", "27.åˆ†è§£ä¸ç»„è£…è‡ªåŠ¨å˜é€Ÿå™¨.mp4",
        "28.ä¸‡å‘ä¼ åŠ¨è£…ç½®è®¤çŸ¥.mp4", "29.ä¸‡å‘ä¼ åŠ¨è£…ç½®æ‹†è£…æ£€ä¿®.mp4", "30.é©±åŠ¨æ¡¥è®¤çŸ¥.mp4",
        "31.è½¦æ¶è®¤çŸ¥.mp4", "32.è½¦è½®è½¦èƒè®¤çŸ¥.mp4", "33.è½¦è½®æ‹†è£…æ£€ä¿®.mp4", "34.æ‚¬æ¶ç³»ç»Ÿè®¤çŸ¥.mp4",
        "35.æ‚¬æ¶æ‹†è£…æ£€ä¿®.mp4", "36.è½¬å‘ä¸æ“çºµç³»ç»Ÿè®¤çŸ¥.mp4", "37.è½¬å‘æ“çºµç³»ç»Ÿæ‹†è£…æ£€ä¿®.mp4",
        "38.è½¬å‘å™¨è®¤çŸ¥.mp4", "39.è½¬å‘å™¨æ‹†è£…æ£€ä¿®.mp4", "40.æ¶²å‹åŠ©åŠ›è½¬å‘ä¼ åŠ¨ç³»ç»Ÿè®¤çŸ¥.mp4",
        "41.æ¶²å‹åŠ©åŠ›è½¬å‘ä¼ åŠ¨è£…ç½®æ‹†è£…æ£€ä¿®.mp4", "42.ç”µåŠ¨åŠ©åŠ›è½¬å‘ä¼ åŠ¨ç³»ç»Ÿè®¤çŸ¥.mp4", "43.ç”µåŠ¨åŠ©åŠ›è½¬å‘ä¼ åŠ¨è£…ç½®æ‹†è£…æ£€ä¿®.mp4",
        "44.åˆ¶åŠ¨å™¨è®¤çŸ¥.mp4", "45.ç›˜å¼åˆ¶åŠ¨å™¨æ‹†è£…æ£€ä¿®.mp4", "46-é¼“å¼åˆ¶åŠ¨å™¨æ‹†è£…æ£€ä¿®.mp4",
        "47.æ¶²å‹ã€æ°”å‹åˆ¶åŠ¨ä¼ åŠ¨è£…ç½®è®¤çŸ¥.mp4", "48.æ¶²å‹ã€æ°”å‹åˆ¶åŠ¨ä¼ åŠ¨è£…ç½®æ‹†è£…æ£€ä¿®.mp4", "49.ABSã€ASRåˆ¶åŠ¨æ§åˆ¶ç³»ç»Ÿè®¤çŸ¥.mp4",
        "50.ABSã€ASRåˆ¶åŠ¨æ§åˆ¶ç³»ç»Ÿæ‹†è£…æ£€ä¿®.mp4", "51.æ±½è½¦è½¦èº«ç»“æ„åŠé™„ä»¶è®¤çŸ¥.mp4", "52.æ±½è½¦è½¦èº«ç»“æ„åŠé™„ä»¶æ‹†è£….mp4",
        "53.æ±½è½¦ä»ªè¡¨è®¤çŸ¥.mp4", "54.æ±½è½¦ä»ªè¡¨æ‹†è£…æ£€ä¿®.mp4", "55.æ±½è½¦ç…§æ˜è£…ç½®è®¤çŸ¥.mp4",
        "56.æ±½è½¦ç…§æ˜è£…ç½®æ‹†è£…æ£€ä¿®.mp4", "57.æ±½è½¦ç”µåŠ¨è½¦çª—è®¤çŸ¥.mp4", "58.æ±½è½¦ç”µåŠ¨è½¦çª—æ‹†è£….mp4",
        "59.æ±½è½¦ç”µåŠ¨åº§æ¤…è®¤çŸ¥.mp4", "60.æ±½è½¦ç”µåŠ¨åº§æ¤…æ‹†è£….mp4", "61.æ±½è½¦ç”µåŠ¨è¾…åŠ©è£…ç½®è®¤çŸ¥.mp4",
        "62.æ±½è½¦ç”µåŠ¨è¾…åŠ©è£…ç½®æ‹†è£….mp4", "63.æ±½è½¦ç©ºè°ƒç³»ç»Ÿè®¤çŸ¥.mp4", "64.æ±½è½¦ç©ºè°ƒç³»ç»Ÿå¸¸è§æ•…éšœæ£€ä¿®.mp4",
        "65.æ–°èƒ½æºæ±½è½¦è®¤çŸ¥.mp4", "66.æ–°èƒ½æºæ±½è½¦åŠ¨åŠ›ç”µæ± ç³»ç»Ÿè®¤çŸ¥.mp4", "67.æ–°èƒ½æºæ±½è½¦é«˜å‹å®‰å…¨ç»´æŠ¤.mp4",
        "68.æ–°èƒ½æºæ±½è½¦åŠ¨åŠ›ç”µæ± ç³»ç»Ÿæ‹†è£…æ£€ä¿®.mp4", "69.æ–°èƒ½æºæ±½è½¦é©±åŠ¨ç”µæœºç³»ç»Ÿè®¤çŸ¥.mp4", "70.æ–°èƒ½æºæ±½è½¦é©±åŠ¨ç”µæœºç³»ç»Ÿæ‹†è£…æ£€ä¿®.mp4",
        "71.æ–°èƒ½æºæ±½è½¦é«˜å‹é…ç”µç³»ç»Ÿè®¤çŸ¥.mp4", "72.æ–°èƒ½æºæ±½è½¦é«˜å‹é…ç”µç³»ç»Ÿæ‹†è£…æ£€ä¿®.mp4"
            ]
        },
        {
            id: "ppt",
            name: "æ€æ”¿è¯¾ä»¶ (PPT)",
            icon: "ğŸ“Š",
            color: "#ffebee",
            folderName: "ã€Šæ±½è½¦æ„é€ ã€‹/PPT",
            items: [
                "æ€æ”¿01-å›½å®¶æƒ…æ€€.pptx",
                "æ€æ”¿02-å¤§å›½è‡ªä¿¡.pptx",
                "æ€æ”¿03-å·¥åŒ ç²¾ç¥.pptx",
                "æ€æ”¿04-åˆ›æ–°ç²¾ç¥.pptx",
                "æ€æ”¿05-ç§‘æŠ€ç²¾ç¥.pptx"
            ]
        },
        {
            id: "image",
            name: "æ•™å­¦å›¾ç‰‡ç´ æ",
            icon: "ğŸ–¼ï¸",
            color: "#e8f5e9",
            folderName: "ã€Šæ±½è½¦æ„é€ ã€‹/å›¾ç‰‡",
            items: [
                "1.jpg", "2.jpg", "3.jpg", "4.jpg", "5.jpg",
                "6.jpg", "7.jpg", "8.jpg", "9.jpg", "10.jpg"
            ]
        }
    ];

    // ================= æ ¸å¿ƒé€»è¾‘ =================
    const folderView = document.getElementById('folderView');
    const fileView = document.getElementById('fileView');
    const backBtn = document.getElementById('backBtn');
    const pageTitle = document.getElementById('pageTitle');
    const modal = document.getElementById('previewModal');
    const modalContent = document.getElementById('modalContent');

    function init() {
        folderView.innerHTML = '';
        projects.forEach((proj, index) => {
            const div = document.createElement('div');
            div.className = 'folder-card';
            div.style.borderBottom = `5px solid ${proj.color.replace('e', 'c')}`;
            div.onclick = () => openFolder(index);
            div.innerHTML = `
                <span class="folder-icon">${proj.icon}</span>
                <div class="folder-name">${proj.name}</div>
                <div class="folder-count">${proj.items.length} ä¸ªæ–‡ä»¶</div>
            `;
            folderView.appendChild(div);
        });
    }

    function openFolder(index) {
        const proj = projects[index];
        folderView.style.display = 'none';
        fileView.style.display = 'grid';
        backBtn.style.display = 'block';
        pageTitle.innerText = proj.name;
        renderFiles(proj);
        window.scrollTo(0, 0);
    }

    function goHome() {
        fileView.style.display = 'none';
        folderView.style.display = 'grid';
        backBtn.style.display = 'none';
        pageTitle.innerText = "èµ„æºåº“é¦–é¡µ";
        fileView.innerHTML = ''; // æ¸…ç©ºåˆ—è¡¨ï¼Œé‡Šæ”¾å†…å­˜
        closeModal();
    }

    function renderFiles(proj) {
        fileView.innerHTML = '';
        const cleanFolder = proj.folderName ? proj.folderName.replace(/\/$/, '') : "";
        const folderPart = cleanFolder ? (encodeURI(cleanFolder) + "/") : "";

        proj.items.forEach((filename, idx) => {
            const rawUrl = r2Base + folderPart + encodeURIComponent(filename);
            const ext = filename.split('.').pop().toLowerCase();
            const card = document.createElement('div');
            card.className = 'card';

            let contentHTML = '';

            // --- ğŸ¬ è§†é¢‘ï¼šå°é¢å ä½æ¨¡å¼ (Lazy Load) ---
            // åªæœ‰ç‚¹å‡»æ’­æ”¾æŒ‰é’®æ—¶ï¼Œæ‰çœŸæ­£æ’å…¥ video æ ‡ç­¾
            if (['mp4', 'mov'].includes(ext)) {
                const uniqueId = `vid-${idx}`;
                contentHTML = `
                    <div class="media-wrapper" id="${uniqueId}" onclick="loadAndPlayVideo('${uniqueId}', '${rawUrl}')">
                        <div class="video-placeholder">
                            <div class="play-icon">â–¶</div>
                            <div style="font-size:0.8rem; margin-top:10px; color:#999;">ç‚¹å‡»åŠ è½½è§†é¢‘</div>
                        </div>
                    </div>`;
            } 
            // --- ğŸ–¼ï¸ å›¾ç‰‡ ---
            else if (['jpg', 'png', 'jpeg'].includes(ext)) {
                contentHTML = `
                    <div class="media-wrapper">
                        <img src="${rawUrl}" class="safe-img" ondragstart="return false">
                    </div>`;
            } 
            // --- ğŸ“Š PPT/PDFï¼šç‚¹å‡»æ”¾å¤§æ¨¡å¼ ---
            else {
                const isPdf = ext === 'pdf';
                const icon = isPdf ? 'ğŸ“„' : 'ğŸ“Š';
                const typeText = isPdf ? 'PDFæ–‡æ¡£' : 'PPTè¯¾ä»¶';
                
                contentHTML = `
                    <div class="media-wrapper" onclick="previewDoc('${rawUrl}', '${ext}', '${filename}')">
                        <div class="ppt-cover">
                            <div class="ppt-icon">${icon}</div>
                            <div class="ppt-hint">ç‚¹å‡»å…¨å±æŸ¥çœ‹</div>
                            <div style="font-size:0.8em;color:#999;margin-top:5px;">${typeText}</div>
                        </div>
                    </div>`;
            }

            card.innerHTML = `
                ${contentHTML}
                <div class="info"><h3>${filename}</h3></div>
            `;
            fileView.appendChild(card);
        });
    }

    // --- è§†é¢‘æŒ‰éœ€åŠ è½½é€»è¾‘ ---
    window.loadAndPlayVideo = function(containerId, url) {
        const container = document.getElementById(containerId);
        // é˜²æ­¢é‡å¤ç‚¹å‡»
        if(container.querySelector('video')) return;

        // åŠ¨æ€åˆ›å»º video æ ‡ç­¾ï¼Œå®ç°çœŸæ­£çš„"ç‚¹å‡»æ—¶æ‰åŠ è½½"
        container.innerHTML = `
            <video controls autoplay controlsList="nodownload" playsinline oncontextmenu="return false">
                <source src="${url}" type="video/mp4">
            </video>
        `;
        // å»æ‰ç‚¹å‡»äº‹ä»¶ï¼Œé˜²æ­¢å†æ¬¡è§¦å‘
        container.onclick = null;
        container.style.cursor = 'default';
    }

    // --- å…¨å±é¢„è§ˆé€»è¾‘ ---
    window.previewDoc = function(url, ext, title) {
        document.getElementById('modalTitle').innerText = title;
        modal.style.display = 'flex';
        modalContent.innerHTML = '<div style="color:#fff;text-align:center;padding-top:100px;">æ­£åœ¨å»ºç«‹å®‰å…¨è¿æ¥...</div>';

        let iframeSrc = "";
        // å¾®è½¯æ¥å£è‡ªå¸¦é˜²ä¸‹è½½å±æ€§ï¼Œä¸”åªè¯»
        if (['ppt', 'pptx', 'doc', 'docx'].includes(ext)) {
            iframeSrc = msViewer + encodeURIComponent(url);
        } else if (ext === 'pdf') {
            iframeSrc = url + "#toolbar=0";
        }

        setTimeout(() => {
            modalContent.innerHTML = `<iframe class="full-viewer" src="${iframeSrc}"></iframe>`;
        }, 300);
    }

    window.closeModal = function() {
        modal.style.display = 'none';
        modalContent.innerHTML = '';
    }

    init();
</script>

</body>
</html>
